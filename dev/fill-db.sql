-- Вставка категорий
INSERT INTO public.categories (name, description)
VALUES ('Черный чай', 'Классический черный чай с насыщенным вкусом и ароматом.'),
       ('Зеленый чай', 'Легкий и освежающий зеленый чай, богатый антиоксидантами.'),
       ('Улун', 'Полуферментированный чай с уникальным вкусом и ароматом.'),
       ('Пуэр', 'Ферментированный чай с землистым вкусом, улучшающийся со временем.'),
       ('Белый чай', 'Нежный чай из молодых почек и листьев, минимально обработанный.'),
       ('Травяной чай', 'Напитки из различных трав, цветов и фруктов, не содержащие кофеина.'),
       ('Фруктовый чай', 'Ароматные смеси на основе фруктов и ягод.');

-- Вставка тегов
INSERT INTO public.tags (name, color)
VALUES ('Бодрящий', '#FF5733'),
       ('Успокаивающий', '#33A7FF'),
       ('Терпкий', '#8B4513'),
       ('Сладкий', '#FFC0CB'),
       ('Цветочный', '#FF69B4'),
       ('Фруктовый', '#FFA500'),
       ('Пряный', '#D2691E'),
       ('Освежающий', '#00FFFF'),
       ('Насыщенный', '#800000'),
       ('Легкий', '#ADD8E6');

DO
$$
DECLARE
category_ids UUID[];
    tag_ids
UUID[];
    selected_category_id
UUID;
    selected_tag_id
UUID;
    new_tea_id
UUID;
    i
INTEGER;
    tea_names
VARCHAR[] := ARRAY[
        'Эрл Грей Классик', 'Сенча Японская', 'Те Гуань Инь', 'Шу Пуэр Дворцовый', 'Бай Му Дань', 'Ромашковый Луг', 'Малиновый Рай',
        'Ассам Крепкий', 'Лунцзин Весенний', 'Да Хун Пао', 'Менхайский Пуэр', 'Серебряные Иглы', 'Мятная Прохлада', 'Клубничный Восторг',
        'Дарджилинг Гималайский', 'Гёкуро Императорский', 'Фэн Хуан Дань Цун', 'Лао Бань Чжан', 'Шоу Мэй', 'Лавандовый Сон', 'Яблочный Пирог',
        'Цейлонский Завтрак', 'Матча Церемониальная', 'Жоу Гуй', 'Сяо Гуань Ча', 'Белый Пион', 'Имбирный Огонь', 'Вишневый Сад',
        'Кимун Китайский', 'Ходзича Жареный', 'Шуйсянь', 'Юэ Гуан Бай', 'Липовый Цвет', 'Апельсиновая Долька',
        'Лапсанг Сушонг Копченый', 'Би Ло Чунь Изумрудные Спирали', 'Бай Цзи Гуань', 'Бин Дао Пуэр', 'Гун Мэй', 'Мелисса Лимонная', 'Персиковый Нектар',
        'Юньнань Золотые Ворсинки', 'Кабусеча Тенистый', 'Ци Лань', 'Ман Фэй Шэн Пуэр', 'Инь Чжэнь', 'Чабрец Горный', 'Манговый Бриз',
        'Золотой Юньнань', 'Генмайча с Рисом', 'У И Янь Ча'
    ];
    tea_descriptions
VARCHAR[] := ARRAY[
        'Ароматный черный чай с бергамотом.', 'Классический японский зеленый чай.', 'Знаменитый китайский улун.', 'Выдержанный шу пуэр.', 'Нежный белый чай.', 'Успокаивающий травяной сбор.', 'Яркий фруктовый чай.',
        'Крепкий индийский черный чай.', 'Премиальный китайский зеленый чай.', 'Скальный улун с богатым вкусом.', 'Классический шу пуэр из Мэнхая.', 'Элитный белый чай из почек.', 'Освежающий мятный чай.', 'Сладкий чай с ароматом клубники.',
        'Высокогорный индийский черный чай.', 'Японский зеленый чай высшего сорта.', 'Улун с ароматом орхидеи.', 'Знаменитый шэн пуэр.', 'Белый чай "Брови старца".', 'Расслабляющий чай с лавандой.', 'Ароматный чай со вкусом яблочного пирога.',
        'Классический черный чай с Цейлона.', 'Порошковый зеленый чай для церемоний.', 'Улун "Корица с гор У И".', 'Порционный китайский чай.', 'Популярный белый чай.', 'Согревающий чай с имбирем.', 'Фруктовый чай с ароматом вишни.',
        'Красный китайский чай с цветочным ароматом.', 'Японский зеленый чай обжаренных листьев.', 'Темный улун "Водный нарцисс".', 'Белый чай "Лунный свет".', 'Душистый чай с цветами липы.', 'Чай с ярким цитрусовым ароматом.',
        'Копченый черный чай с дымным ароматом.', 'Знаменитый зеленый чай "Изумрудные спирали весны".', 'Улун "Белый петушиный гребень".', 'Шэн пуэр из региона Бин Дао.', 'Белый чай "Дань уважения".', 'Успокаивающий чай с мелиссой.', 'Сладкий чай с ароматом персика.',
        'Черный чай из Юньнани с золотистыми типсами.', 'Японский зеленый чай, выращенный в тени.', 'Улун "Чудесная орхидея".', 'Шэн пуэр из деревни Ман Фэй.', 'Белый чай "Серебряные иглы".', 'Ароматный чай с чабрецом.', 'Экзотический чай с ароматом манго.',
        'Премиальный черный чай из Юньнани.', 'Японский зеленый чай с обжаренным рисом.', 'Темный улун с гор У И.'
    ];
    current_name
VARCHAR;
    current_description
VARCHAR;
    name_exists
BOOLEAN;

BEGIN
SELECT array_agg(id)
INTO category_ids
FROM public.categories;
SELECT array_agg(id)
INTO tag_ids
FROM public.tags;

FOR i IN 1..50 LOOP
        -- Выбираем уникальное имя и описание
        LOOP
            current_name := tea_names[1 + floor(random() * array_length(tea_names, 1))::integer];
            current_description
:= tea_descriptions[1 + floor(random() * array_length(tea_descriptions, 1))::integer];
SELECT EXISTS(SELECT 1 FROM public.teas WHERE name = current_name)
INTO name_exists;
EXIT
WHEN NOT name_exists;
END LOOP;

        selected_category_id
:= category_ids[1 + floor(random() * array_length(category_ids, 1))::integer];

INSERT INTO public.teas (name, serve_price, description, category_id, unit_price)
VALUES (current_name,
        round((random() * 20 + 5):: numeric, 2), -- serve_price от 5 до 25
        current_description,
        selected_category_id,
        round((random() * 100 + 20):: numeric, 2) -- unit_price от 20 до 120
       ) RETURNING id
INTO new_tea_id;

-- Добавляем 1-3 случайных тега для каждого чая
FOR j IN 1..floor(random() * 3 + 1)::integer LOOP
            selected_tag_id := tag_ids[1 + floor(random() * array_length(tag_ids, 1))::integer];
            -- Избегаем дублирования тегов для одного чая
            IF
NOT EXISTS (SELECT 1 FROM public.teas_tags WHERE tea_id = new_tea_id AND tag_id = selected_tag_id) THEN
                INSERT INTO public.teas_tags (tea_id, tag_id)
                VALUES (new_tea_id, selected_tag_id);
END IF;
END LOOP;
END LOOP;
END $$;
